<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="style-reset.html">
<link rel="import" href="cr-chat-message.html">
<link rel="import" href="cr-chat-request.html">

<dom-module id="info-section">
  <template>
    <!--suppress CssNoGenericFontName -->
    <style include="style-reset">
      :host {
        display: block;
        margin: 0;
        padding: 0;
        color: white;
        width: 100vw;
        height: calc(100vh - 60px);
        overflow-x: hidden;
        overflow-y: auto;
      }

      .tabs > ul {
        list-style: none;
        margin: 0;
        padding: 0;
        white-space: nowrap;
        overflow-x: auto;
        overflow-y: hidden;
      }

      .tabs > ul > li {
        display: inline-block;
        cursor: pointer;
        text-align: center;
        font-family: 'Supercell Magic';
        padding: 8px 18px 6px 18px;
        margin: 0 1px;
        border-radius: 10px 10px 0 0;
        border: 3px solid #7ea0b8;
        font-size: 18px;
        color: #3cf;
        text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 2px 0 #000, 1px 2px 0 #000;
        background-color: #677e97;
        transition: .2s background-color ease-in-out, .2s padding ease-in-out;
      }

      .tabs > ul > li:hover {
        background-color: #82a0ba;
      }

      .tabs > ul > li.selected {
        padding-top: 6px;
        background-color: #e2eff2;
        border: 3px solid #fff;
      }

      .content {
        position: absolute;
        top: 44px;
        left: 0;
        width: 100vw;
        min-height: calc(100vh - 104px);
        /* color: #666;
        background-color: #e2eff2; */
      }

      .spacer {
        width: 24px;
        visibility: hidden;
      }

      .content > ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .content > ul > li {
        display: none;
      }

      .content > ul > li.selected {
        display: block;
      }

      .chat-container {
        position: absolute;
        top: 82px;
        left: 0;
        width: 100vw;
        height: calc(100vh - 186px);
        overflow-y: auto;
      }

      .chat {
        position: absolute;
        top: 0;
        left: 0;
        width: calc(100vw - 32px);
        max-width: 720px;
        min-height: calc(100vh - 218px);
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: flex-start;
        margin: 16px;
      }

      .chat-header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        background-color: #e2eff2;
        display: flex;
        align-items: center;
        z-index: 3;
      }

      .chat-header img {
        height: 82px;
        padding: 4px;
        width: auto;
      }

      .chat-header h3 {
        color: white;
        font-size: 20px;
        text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 2px 0 #000, 1px 2px 0 #000;
      }

      .changelog-container {
        background-color: #e2eff2;
        position: absolute;
        top: 0;
        left: 0;
        padding: 8px 0;
        width: 100vw;
        height: calc(100vh - 123px);
        overflow-y: auto;
      }

      .changelog-container ul {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .changelog-container li {
        background-color: #fff;
        border: 1px solid #999;
        border-radius: 6px;
        margin: 8px;
        padding: 8px;
        width: 90vw;
        max-width: 720px;
      }

      .changelog-header {
        overflow: hidden;
      }

      .changelog-container h3 {
        float: left;
        color: #999;
        font-size: 16px;
        font-family: 'Supercell Magic';
        margin: 0;
      }

      .changelog-container h4 {
        float: right;
        color: #999;
        font-size: 10px;
        font-family: 'SC CCBackBeat';
        margin: 0;
      }

      .changelog-container p {
        color: #666;
        font-size: 14px;
        font-family: 'SC CCBackBeat';
      }

      p {
        margin: 6px 0;
      }
    </style>

    <nav class="tabs">
      <ul role="tablist">
        <li class="spacer"></li>
        <li role="tab" class="selected">[[localize('chat-tab')]]</li>
        <li role="tab">[[localize('about-tab')]]</li>
        <li role="tab">[[localize('changelog-tab')]]</li>
        <li role="tab">[[localize('credits-tab')]]</li>
        <li role="tab">[[localize('special-thanks-tab')]]</li>
        <li class="spacer"></li>
      </ul>
    </nav>
    <section class="content">
      <ul role="group">
        <li class="selected">
          <div class="chat-container">
            <div class="chat">
              <cr-chat-message from="Dabolus" user-role="[[localize('message-role')]]"
                               date="[[localize('message-date')]]">
                <p>[[localize('message-content.part1')]]</p>
                <p>[[localize('message-content.part2')]]</p>
                <p>[[localize('message-content.part3')]]</p>
              </cr-chat-message>
              <cr-chat-request from="Dabolus" donation-header="[[localize('donation-header')]]"
                               donation-text="[[localize('donation-text')]]"
                               donation-button-text="[[localize('donation-button-text')]]">
              </cr-chat-request>
            </div>
          </div>
          <div class="chat-header">
            <img src="../assets/navbar/create.svg">
            <h3>CRCM Clan</h3>
          </div>
        </li>
        <li>bbb</li>
        <li>
          <div class="changelog-container">
            <ul>
              <li>
                <div class="changelog-header">
                  <h3>1.2.0</h3>
                  <h4>2017-08-23</h4>
                </div>
                <p>
                  Added Spanish translation
                </p>
              </li>
              <li>
                <div class="changelog-header">
                  <h3>1.1.0</h3>
                  <h4>2016-11-24</h4>
                </div>
                <p>
                  Added Portuguese translation (thanks to <a href="http://supr.cl/RoyaleDicas" target="CRD">Clash Royale
                  Dicas</a>!).<br>
                  Started translating the whole website in the various languages.<br>
                  Fixed the undefined type of troop problem that some users had.<br>
                  Lots of bugfixes and improvements as suggested by you!
                </p>
              </li>
              <li>
                <div class="changelog-header">
                  <h3>1.0.0 - Finally out of the beta!</h3>
                  <h4>2016-11-07</h4>
                </div>
                <p>
                  The created cards are now in HD.<br>
                  You can now choose various options to save your card or to automatically upload it to imgur!<br>
                  Resize and crop the card image as you wish!<br>
                  Drag and drop the card properties to change their order.<br>
                  Added Japanese translation (thanks to <a href="https://forum.supercell.com/member.php/1811075-WCF20"
                                                           target="WCF20Profile">WCF20</a> for the translation).<br>
                  Finally fixed the problems with Safari.<br>
                  Many other fixes and enhancements.
                </p>
              </li>
              <li>
                <div class="changelog-header">
                  <h3>0.4.1b</h3>
                  <h4>2016-10-26</h4>
                </div>
                <p>
                  Fixed compatibility issues with older browsers.<br>
                  Added some missing icons.
                </p>
              </li>
              <li>
                <div class="changelog-header">
                  <h3>0.4.0b</h3>
                  <h4>2016-10-25</h4>
                </div>
                <p>Added an awesome info menu.</p>
              </li>
              <li>
                <div class="changelog-header">
                  <h3>0.3.0b</h3>
                  <h4>2016-10-24</h4>
                </div>
                <p>
                  Choose if you want the property icon background and the info button.<br>
                  Restyled the donate process.
                </p>
              </li>
              <li>
                <div class="changelog-header">
                  <h3>0.2.0b</h3>
                  <h4>2016-10-23</h4>
                </div>
                <p>
                  Added the possibility to switch the card language.<br>
                  Now it is possible to export and import the cards in JSON format.
                </p>
              </li>
              <li>
                <div class="changelog-header">
                  <h3>0.1.1b</h3>
                  <h4>2016-10-21</h4>
                </div>
                <p>Icons hotfix.</p>
              </li>
              <li>
                <div class="changelog-header">
                  <h3>0.1.0b</h3>
                  <h4>2016-10-21</h4>
                </div>
                <p>Initial release.</p>
              </li>
            </ul>
          </div>
        </li>
        <li>ddd</li>
        <li>eee</li>
      </ul>
    </section>
  </template>
  <script>
    /**
     * @customElement
     * @polymer
     */
    class InfoSection extends Polymer.mixinBehaviors(
        [Polymer.AppLocalizeBehavior], Polymer.Element) {
      static get is() {
        return 'info-section';
      }

      static get properties() {
        return {
          language: {
            value: () => {
              return sessionStorage.getItem('language') || 'en';
            },
          },
          selectedTabIndex: {
            type: Number,
            value: 0,
          },
        };
      }

      attached() {
        super.attached();
        this.loadResources(
            this.resolveUrl(`locales/info-section.${this.language}.json`),
        );
        this._tabs = this.shadowRoot.querySelectorAll('.tabs > ul > li[role=tab]');
        this._tabViews = this.shadowRoot.querySelectorAll('.content > ul > li');
        for (let i = 0; i < this._tabs.length; i++) {
          this._tabs[i].addEventListener('click', () => this._changeTab(i));
        }
      }

      _changeTab(newTabIndex) {
        if (this.selectedTabIndex === newTabIndex) {
          return;
        }
        this._tabs[this.selectedTabIndex].className = this._tabViews[this.selectedTabIndex].className = '';
        this._tabs[newTabIndex].className = this._tabViews[newTabIndex].className = 'selected';
        this.selectedTabIndex = newTabIndex;
      }
    }

    window.customElements.define(InfoSection.is, InfoSection);
  </script>
</dom-module>
